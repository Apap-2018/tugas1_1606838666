<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.com">
  <head>
    <title th:replace="fragments/fragment :: title"></title>
    <object th:include="fragments/fragment :: css&js" th:remove="tag"></object>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>

  <body>
    <nav th:replace="fragments/fragment :: navbar"></nav>

    <div class="container-fluid">
      <h3>Tambah Pegawai</h3>

      <form id="form-pegawai" th:action="@{/pegawai/tambah}" method="POST" th:object="${pegawai}">
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Nama</label>
          <div class="col-4">
            <input type="text" class="form-control" id="" th:field="*{nama}">
          </div>
        </div>
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Tempat Lahir</label>
          <div class="col-4">
            <input type="text" class="form-control" id="" th:field="*{tempatLahir}">
          </div>
        </div>
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Tanggal Lahir</label>
          <div class="col-4">
            <input type="date" class="form-control" id="" th:field="*{tanggalLahir}">
          </div>
        </div>
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Tahun Masuk</label>
          <div class="col-4">
            <input type="number" class="form-control" id="" th:field="*{tahunMasuk}">
          </div>
        </div>
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Provinsi</label>
          <div class="col-4">
            <select class="form-control" id="provinsi">
              <option th:each="provinsi : ${listProvinsi}" th:text="${provinsi.nama}" th:value="${provinsi.nama}"></option>
            </select>
          </div>
        </div>
        <div class="form-group row">
          <label for="" class="col-2 col-form-label">Nama Instansi</label>
          <div class="col-4">
            <select class="form-control" id="namaInstansi" name="id_instansi">

            </select>
          </div>
        </div>
        <div class="form-group row">
          <label class="col-2 col-form-label">Jabatan</label>
          <div class="col-4" id="jabatan-section">
            <span th:each="slotJabatan, rowStats: *{listJabatan}">
              <select class="form-control" id="" th:field="*{listJabatan[__${rowStats.index}__].jabatan}" style="margin-top: 1.5%;">
                <option th:each="jabatan : ${listAllJabatan}" th:value="${jabatan.id}" th:text="${jabatan.nama}"></option>
              </select>
            </span>
          </div>
        </div>
        <div class="form-group row">
          <div class="col-2"></div>
          <div class="col-4">
            <button type="submit" class="btn btn-primary" name="addJabatanRow">Tambah Jabatan Lainnya</button>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Simpan</button>
      </form>
    </div>

    <script type="text/javascript">
      function getProvinsi() {
        $.ajax({
            method: "POST",
            contentType: "application/json",
            url: "/provinsi/get/instansi",
            data: JSON.stringify( {nama: $("#provinsi").val()} ),
            cache: false,
            success : function (response) {
              console.log(response);
              for (var i = 0; i < response.listOfInstansiModel.length; i++) {
                $("#namaInstansi").append(`<option value="${response.listOfInstansiModel[i].id}">${response.listOfInstansiModel[i].nama}</option>`);
              };
            },
        });
      }

      $(document).ready(function () {
        getProvinsi();
      });

      $("#provinsi").on("change", function () {
        getProvinsi();
      });

      $("#form-pegawai").submit(function (event) {
        // event.preventDefault();
        // console.log($("#namaInstansi").val());
        // var params = {};
        // params["namaPegawai"] = $("#namaPegawai").val();
        // params["tempatLahir"] = $("#tempatLahir").val();
        // params["tanggalLahir"] = $("#tanggalLahir").val();
        // params["tahunMasuk"] = $("#tahunMasuk").val();
        // params["provinsi"] = $("#provinsi").val();
        // params["namaInstansi"] = $("#namaInstansi").val();
        // params["listJabatan"] = [];
        // for (var i = 1; i <= currentIndex+1; i++) {
        //   params["listJabatan"].push($(`#jabatan${i} option:selected`).html());
        // }
        // console.log(params);
        // $.ajax({
        //     method: "POST",
        //     contentType: "application/json",
        //     url: "/pegawai/tambah",
        //     data: JSON.stringify(params),
        //     cache: false,
        //     success : function (response) {
        //       window.location.href = "/pegawai/berhasil/tambah?nip=" + response.message;
        //     },
        // });
      })

    </script>
  </body>
</html>
